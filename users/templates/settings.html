<!-- settings.html -->

{% extends "base.html" %}
{% load static %}

{% block title %}Settings | Chess Coach{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/settings.css' %}">
{% endblock %}

{% block content %}
<div class="settings-page">
    
    {% if messages %}
        <ul class="messages">
            {% for message in messages %}
                <li{% if message.tags %} class="{{ message.tags }}"{% endif %}>{{ message }}</li>
            {% endfor %}
        </ul>
    {% endif %}
    
    <div class="settings-header">
        <h2>Account Settings</h2>
        <p>Manage your user profile configuration</p>
    </div>

    <div class="settings-section">
        <h3>Update Email</h3>
        <form method="POST" class="settings-form">
            {% csrf_token %}
            
            <div class="form-group">
                <label for="{{ email_form.email.id_for_label }}">New Email Address</label>
                {{ email_form.email }}
                {% if email_form.email.errors %}
                    <small class="text-danger">{{ email_form.email.errors|striptags }}</small>
                {% endif %}
            </div>
            
            <input type="hidden" name="update_email" value="true">
            <button type="submit" class="btn-save">Update Email</button>
        </form>
    </div>

    <div class="settings-section">
        <h3>Update Chess.com Username</h3>
        <p>Keep it updated to sync your stats accurately.</p>
        <form method="POST" class="settings-form">
            {% csrf_token %}
            
            <div class="form-group">
                <label for="{{ chess_username_form.chess_username.id_for_label }}">New Chess.com Username</label>
                {{ chess_username_form.username }}
                {% if chess_username_form.username.errors %}
                    <small class="text-danger">{{ chess_username_form.username.errors|striptags }}</small>
                {% endif %}
            </div>
            
            <input type="hidden" name="update_chess_username" value="true">
            <button type="submit" class="btn-save">Update Chess Username</button>
        </form>
    </div>

    <div class="settings-section">
        <h3>Change Password</h3>
        <form method="POST" class="settings-form">
            {% csrf_token %}
            
            {% for field in password_form %}
                <div class="form-group">
                    <label for="{{ field.id_for_label }}">{{ field.label }}</label>
                    {{ field }}
                    {% if field.errors %}
                        <small class="text-danger">{{ field.errors|striptags }}</small>
                    {% endif %}
                </div>
            {% endfor %}

            <input type="hidden" name="change_password" value="true">
            <button type="submit" class="btn-save">Update Password</button>
        </form>
    </div>

    <div class="settings-section delete-section">
        <h3>Delete Account</h3>
        <p class="warning-text">Permanently delete your account and all associated game data. This action cannot be undone.</p>
        
        <form method="POST" action="{% url 'users:delete_account' %}" id="deleteAccountForm">
            {% csrf_token %}
            <button type="submit" class="btn-delete">Delete Account</button>
        </form>
    </div>

    <div class="settings-footer">
        <a href="{% url 'users:profile' %}" class="btn-back">‚Üê Back to Profile</a>
    </div>

</div>
{% endblock %}

{% block extra_js %}

<script>
document.addEventListener('DOMContentLoaded', function() {
    if (document.activeElement) {
        document.activeElement.blur();
    }
    
    document.body.focus();
});
</script>

{% endblock %}